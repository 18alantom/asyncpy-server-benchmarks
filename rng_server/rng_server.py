from .response import get_body


async def app(scope, receive, send):
    assert scope["type"] == "http"
    await send(
        {
            "type": "http.response.start",
            "status": 200,
            "headers": [
                [b"content-type", b"application/json"],
            ],
        }
    )

    await send(
        {
            "type": "http.response.body",
            "body": get_body(),
        }
    )


# SERVER COMMAND:
#   uvicorn --workers 21 --log-level critical rng_server.rng_server:app
#
# AUTOCANNON OUTPUT:
#   Running 10s test @ http://127.0.0.1:8000
#   10 connections
#
#
#   ┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬──────┐
#   │ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max  │
#   ├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼──────┤
#   │ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.04 ms │ 7 ms │
#   └─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴──────┘
#   ┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
#   │ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
#   ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
#   │ Req/Sec   │ 54463   │ 54463   │ 60223   │ 60767   │ 59533.1 │ 1708.58 │ 54455   │
#   ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
#   │ Bytes/Sec │ 11.1 MB │ 11.1 MB │ 12.3 MB │ 12.4 MB │ 12.2 MB │ 348 kB  │ 11.1 MB │
#   └───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
#
#   Req/Bytes counts sampled once per second.
#   # of samples: 11
#
#   655k requests in 11.01s, 134 MB read


# SERVER COMMAND:
#   uvicorn --workers 1 --log-level critical rng_server.rng_server:app
#
# AUTOCANNON OUTPUT:
#   Running 10s test @ http://127.0.0.1:8000
#   10 connections
#
#
#   ┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
#   │ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
#   ├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
#   │ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.06 ms │ 10 ms │
#   └─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
#   ┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬────────┬─────────┐
#   │ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min     │
#   ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
#   │ Req/Sec   │ 42847   │ 42847   │ 44447   │ 45023   │ 44300.8 │ 590.65 │ 42841   │
#   ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
#   │ Bytes/Sec │ 8.75 MB │ 8.75 MB │ 9.08 MB │ 9.19 MB │ 9.04 MB │ 120 kB │ 8.75 MB │
#   └───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴────────┴─────────┘
#
#   Req/Bytes counts sampled once per second.
#   # of samples: 10
#
#   443k requests in 10.01s, 90.4 MB read
